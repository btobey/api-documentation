<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>OAuth2 / Delegated Access &mdash; Carvoyant API 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Carvoyant API 1.0 documentation" href="../index.html" />
    <link rel="up" title="Getting Started" href="index.html" />
    <link rel="next" title="Access &amp; Registration Workflows" href="access-registration.html" />
    <link rel="prev" title="Getting Started" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="access-registration.html" title="Access &amp; Registration Workflows"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Carvoyant API 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Getting Started</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="oauth2-delegated-access">
<h1>OAuth2 / Delegated Access<a class="headerlink" href="#oauth2-delegated-access" title="Permalink to this headline">¶</a></h1>
<p>The Carvoyant system uses an <a class="reference external" href="http://tools.ietf.org/html/rfc6749">OAuth2</a> implementation in order to allow users to delegate access to the applications that they want to use.  All four of the <a class="reference external" href="http://tools.ietf.org/html/rfc6749#section-1.3">Authorization Grant types</a> have been implemented, however, only Authorization Code, Implicit and Client Credentials are available to our standard development partners.  If you need to support the Resource Owner type, please contact us to discuss.</p>
<p>Here is a brief summary of how you will use each of the grant types when accessing the Carvoyant system.  Please refer to the specification for details on each grant type.</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Grant Type</th>
<th class="head">Usage</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-20#section-1.4.1">Authorization Code</a></td>
<td>This type will be used in the scenario where the system making the actual API call is in a secured environment. For example,
web applications where the Carvoyant API call originates from our partners server will use this method. The development partner
will direct the user to a Carvoyant hosted web page where the user will log in and grant access to the development partner. The
Carvoyant system will redirect the user back to an endpoint that the development partner hosts which will contain an authorization
code. The development partner will then make a request from their controlled environment to retrieve an access token to the users
Carvoyant data. That call will be a server to server call over SSL and will require the development partners credentials. The
response will include an access token and a refresh token per the OAuth2 specification. This is the preferred grant type as it
provides the highest level of security in the token negotiation process.</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-20#section-1.4.2">Implicit</a></td>
<td>This type will be used when the calls into the Carvoyant system are made from an insecure environment. The primary example for this
use case is a mobile application. In this process, the development partners application (typically running on a resource controlled
by the user) directs the user to a Carvoyant hosted web page where the user will log in and grant access to the development
partner. The Carvoyant system will redirect the user back to an endpoint that the development partner specifies. That redirect will
contain the access token per the OAuth2 specification. In this grant type, refresh tokens are not provided.</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-20#section-1.4.3">Client Credentials</a></td>
<td>There are a few calls into the Carvoyant API that the development partner will make that does not require a user access token. A
primary example of this is the call to register a new account. Since the account does not exist yet, there is no user to grant
access. API calls using this grant type will still expect an access token, but that token will be requested using only the
development partners credentials.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Configuration Requirements</strong></p>
<p>In order to ensure the security of the OAuth2 process, there are two requirements that must be met. When you registered your application, one of the fields that you were asked for was the &#8220;Register Callback URL&#8221;.  This is the URL that the OAuth2 process will redirect users back to after they authorize your application.  Specifically, it is the value of the redirect_uri in all of the below examples.  There are two important aspects to this</p>
<ol class="arabic simple">
<li>The value MUST be an SSL protected URL of the form <a class="reference external" href="https://">https://</a>... and the certificate must be signed by a trusted certificate authority (ie, self signed certificates are not supported).</li>
<li>All requests that are made into the OAuth2 process must use that value for the redirect_uri. Mismatched values will generate errors and will result in an access token not being generated.</li>
</ol>
<p class="last">If you need to change this value, or are unsure of what it is set to, you can access it by logging into the <a class="reference external" href="https://developer.carvoyant.com/">Developer Console</a> and selecting &#8220;My Account&#8221; in the top right.  This will let you access any applications that you have created keys for.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Below are example calls using cURL to show how to generate tokens under each grant type.</p>
<div class="section" id="id1">
<h3>Authorization Code<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The first step is to request the authorization from the user. This call will return a redirect to the login page.</p>
<p><em>Authorize Request</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>curl -i -X GET -d &quot;client_id=pekfaf6jxk6suyXXXXXXXXXX&quot; --data-urlencode &quot;redirect_uri=http://test.carvoyant.com/&quot; -d &quot;response_type=code&quot; &quot;https://auth.carvoyant.com/OAuth/authorize&quot;

HTTP/1.1 302 Found
Content-Type: text/plain; charset=UTF-8
Date: Mon, 28 Apr 2014 14:03:51 GMT
Location: https://auth.carvoyant.com/login/auth
Server: Apache-Coyote/1.1
Set-Cookie: JSESSIONID=2D3C7E5AA412DF98124B8AC7121FEF7D; Path=/; Secure; HttpOnly
Content-Length: 0
Connection: keep-alive
</pre></div>
</div>
<p>If you did this through a browser, the login screen would appear to the user:</p>
<img alt="../_images/auth-dialog.png" src="../_images/auth-dialog.png" />
<p>After logging in, the user will be redirected to the redirect_url specified in the authorization request with the authorization code appended to it.  For the request above, the redirect uri would look like::</p>
<div class="highlight-python"><div class="highlight"><pre>http://test.carvoyant.com/?code=v369uars628mgkXXXXXXXXXX
</pre></div>
</div>
<p>From this response, the server running at test.carvoyant.com would parse the authorization code and make a request to the token endpoint to read an actual access token.  Note that this request requires the client id and secret key for the development partner to be passed as the Basic Authentication credentials.</p>
<p><em>Access Token Request</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>curl -i --user pekfaf6jxk6suyXXXXXXXXXX:XXXXXXXXXX -d &quot;grant_type=authorization_code&quot; -d &quot;code=v369uars628mgkXXXXXXXXXX&quot; --data-urlencode &quot;redirect_uri=http://test.carvoyant.com/&quot; &quot;https://api.carvoyant.com/oauth/token&quot;
</pre></div>
</div>
<p>The response will include a json body with the access token information.</p>
<p><em>Access Token Response</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>HTTP/1.1 200 OK
Cache-Control: no-store
Content-Type: application/json;charset=UTF-8
Date: Mon, 28 Apr 2014 14:24:34 GMT
Server: Mashery Proxy
X-Mashery-Responder: prod-j-worker-us-east-1c-31.mashery.com
Content-Length: 161
Connection: keep-alive
{
    &quot;token_type&quot;:&quot;bearer&quot;,
    &quot;mapi&quot;:&quot;pekfaf6jxk6suyXXXXXXXXXX&quot;,
    &quot;access_token&quot;:&quot;dmnda67wbdnyayXXXXXXXXXX&quot;,
    &quot;expires_in&quot;:86400,
    &quot;refresh_token&quot;:&quot;f2hqes6fpg37d2XXXXXXXXXX&quot;
}
</pre></div>
</div>
<p>At this point, the development partners system would store the access token and refresh token and use them for future requests.</p>
</div>
<div class="section" id="id2">
<h3>Implicit<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The first step is to request the authorization from the user. This call will return a redirect to the login page.</p>
<p><em>Authorize Request</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>curl -i -X GET -d &quot;client_id=pekfaf6jxk6suyXXXXXXXXXX&quot; --data-urlencode &quot;redirect_uri=http://test.carvoyant.com/&quot; -d &quot;response_type=token&quot; &quot;https://auth.carvoyant.com/OAuth/authorize&quot;

HTTP/1.1 302 Found
Content-Type: text/plain; charset=UTF-8
Date: Mon, 28 Apr 2014 14:03:51 GMT
Location: https://auth.carvoyant.com/login/auth
Server: Apache-Coyote/1.1
Set-Cookie: JSESSIONID=2D3C7E5AA412DF98124B8AC7121FEF7D; Path=/; Secure; HttpOnly
Content-Length: 0
Connection: keep-alive
</pre></div>
</div>
<p>If you did this through a browser, the login screen would appear to the user:</p>
<img alt="../_images/auth-dialog.png" src="../_images/auth-dialog.png" />
<p>After logging in, the user will be redirected to the redirect_url specified in the authorization request with the access token appended to it.  For the request above, the redirect uri would look like::</p>
<div class="highlight-python"><div class="highlight"><pre>http://test.carvoyant.com/?access_token=2pr9tvk3vgnr9aXXXXXXXXXX&amp;token_type=bearer&amp;expires_in=86400
</pre></div>
</div>
<p>From this response, the endpoint at test.carvoyant.com would parse the access token and begin making API calls.</p>
</div>
<div class="section" id="id3">
<h3>Client Credentials<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>In this grant type, there is no user interaction. The development partner requests a token for their client credentials directly.</p>
<p><em>Access Token Request</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>curl -i --user pekfaf6jxk6suyXXXXXXXXXX:XXXXXXXXXX -d &quot;grant_type=client_credentials&quot; &quot;https://api.carvoyant.com/oauth/token&quot;
</pre></div>
</div>
<p>The response will include a json body with the access token information.</p>
<p><em>Access Token Response</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>HTTP/1.1 200 OK
Cache-Control: no-store
Content-Type: application/json;charset=UTF-8
Date: Mon, 28 Apr 2014 14:57:20 GMT
Server: Mashery Proxy
X-Mashery-Responder: prod-j-worker-us-east-1d-32.mashery.com
Content-Length: 161
Connection: keep-alive
{
    &quot;token_type&quot;:&quot;bearer&quot;,
    &quot;mapi&quot;:&quot;pekfaf6jxk6suyXXXXXXXXXX&quot;,
    &quot;access_token&quot;:&quot;n45u7eufgdmfysXXXXXXXXXX&quot;,
    &quot;expires_in&quot;:86400,
    &quot;refresh_token&quot;:&quot;r9acw76k327g3cXXXXXXXXXX&quot;
}
</pre></div>
</div>
<p>At this point, the development partners system would store the access token and refresh token and use them for future requests.</p>
</div>
<div class="section" id="using-the-access-token">
<h3>Using the Access Token<a class="headerlink" href="#using-the-access-token" title="Permalink to this headline">¶</a></h3>
<p>In all grants types, once the access token has been retrieved, calls into the Carvoyant system are done by passing the access token in the HTTP request within the Authorization header.  For example (using a sample access token from the Authorization Code grant type):</p>
<p><em>Request</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>curl -i -H &quot;Authorization: Bearer dmnda67wbdnyayXXXXXXXXXX&quot; &quot;https://api.carvoyant.com/v1/api/vehicle/&quot;
</pre></div>
</div>
<p><em>Response</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Date: Mon, 28 Apr 2014 15:06:47 GMT
Server: Apache-Coyote/1.1
X-Mashery-Responder: prod-j-worker-us-east-1b-36.mashery.com
Content-Length: 1205
Connection: keep-alive
{&quot;vehicle&quot;:[{&quot;name&quot;:&quot;1999 Jeep Wrangler SE&quot;,&quot;label&quot;:&quot;Custom dune buggy&quot;,&quot;vehicleId&quot;:3,&quot;deviceId&quot;:&quot;C201200001&quot;,&quot;vin&quot;:&quot;1J4FY29P7XP442798&quot;,&quot;mileage&quot;:160854.0,&quot;lastWaypoint&quot;:{&quot;timestamp&quot;:&quot;20140428T144739+0000&quot;,&quot;latitude&quot;:28.036441,&quot;longitude&quot;:-82.593687},&quot;running&quot;:false,&quot;lastRunningTimestamp&quot;:&quot;20140428T113035+0000&quot;},{&quot;name&quot;:&quot;Unidentified Vehicle&quot;,&quot;label&quot;:null,&quot;vehicleId&quot;:4,&quot;deviceId&quot;:null,&quot;vin&quot;:null,&quot;mileage&quot;:162151.0,&quot;lastWaypoint&quot;:{&quot;timestamp&quot;:&quot;20131112T231526+0000&quot;,&quot;latitude&quot;:28.036473,&quot;longitude&quot;:-82.593671},&quot;running&quot;:false,&quot;lastRunningTimestamp&quot;:&quot;20131110T190222+0000&quot;},{&quot;name&quot;:&quot;2000 Chevrolet Corvette Hardtop&quot;,&quot;label&quot;:null,&quot;vehicleId&quot;:123,&quot;deviceId&quot;:&quot;4562001045&quot;,&quot;vin&quot;:&quot;1G1YY22G2Y5108919&quot;,&quot;mileage&quot;:111940.0,&quot;lastWaypoint&quot;:{&quot;timestamp&quot;:&quot;20140428T143141+0000&quot;,&quot;latitude&quot;:28.088404,&quot;longitude&quot;:-82.578463},&quot;running&quot;:false,&quot;lastRunningTimestamp&quot;:&quot;20140428T123141+0000&quot;},{&quot;name&quot;:&quot;2013 Subaru XV Crosstrek Limited&quot;,&quot;label&quot;:null,&quot;vehicleId&quot;:284,&quot;deviceId&quot;:&quot;C201200002&quot;,&quot;vin&quot;:&quot;JF2GPAKC5D2889395&quot;,&quot;mileage&quot;:9156.0,&quot;lastWaypoint&quot;:{&quot;timestamp&quot;:&quot;20140428T142731+0000&quot;,&quot;latitude&quot;:27.991497,&quot;longitude&quot;:-82.406288},&quot;running&quot;:false,&quot;lastRunningTimestamp&quot;:&quot;20140428T111028+0000&quot;}],&quot;totalRecords&quot;:4,&quot;actions&quot;:[]}
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/carvoyant-logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">OAuth2 / Delegated Access</a><ul>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#id1">Authorization Code</a></li>
<li><a class="reference internal" href="#id2">Implicit</a></li>
<li><a class="reference internal" href="#id3">Client Credentials</a></li>
<li><a class="reference internal" href="#using-the-access-token">Using the Access Token</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Getting Started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="access-registration.html"
                        title="next chapter">Access &amp; Registration Workflows</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/getting-started/oauth2-delegated-access.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="access-registration.html" title="Access &amp; Registration Workflows"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Getting Started"
             >previous</a> |</li>
        <li><a href="../index.html">Carvoyant API 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Getting Started</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Matt Galvin, Ronnie Williams.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>